<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Cluster health checks This section contains a list of checks to run on your OpenShift 3.9+ source and 4.x target clusters before migration. The pur..."> <meta name="revised" content="5c0780b69338e12110ef830cf64ea9376cc6fbec"> <meta name="author" content="Red Hat Communities of Practice"> <meta name="generator" content="jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Cluster health checks 路 OpenShift Migration Best Practices</title> <meta name="twitter:title" content="Cluster health checks 路 OpenShift Migration Best Practices"> <meta name="twitter:description" content="Cluster health checks This section contains a list of checks to run on your OpenShift 3.9+ source and 4.x target clusters before migration. The pur..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@Red Hat Communities of Practice"> <meta name="twitter:url" content="/openshift-migration-best-practices/02-cluster-health-checks.html"> <meta name="twitter:creator" content="@jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Cluster health checks 路 OpenShift Migration Best Practices"> <meta property="og:description" content="Cluster health checks This section contains a list of checks to run on your OpenShift 3.9+ source and 4.x target clusters before migration. The pur..."> <meta property="og:locale" content="en"> <meta property="og:url" content="/openshift-migration-best-practices/02-cluster-health-checks.html"> <meta property="og:type" content="article"> <meta property="article:author" content="Red Hat Communities of Practice"> <meta property="article:published_time" content="2020-08-20T10:18:51-05:00"> <meta property="article:modified_time" content="2021-08-02T19:33:25-05:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "/openshift-migration-best-practices/02-cluster-health-checks.html" }, "headline": "Cluster health checks 路 OpenShift Migration Best Practices", "image": [], "author": { "@type": "Person", "name": "Red Hat Communities of Practice" }, "datePublished": "2020-08-20T10:18:51-05:00", "dateModified": "2021-08-02T19:33:25-05:00", "publisher": { "@type": "Organization", "name": "Red Hat Communities of Practice", "logo": { "@type": "ImageObject", "url": "https://avatars.githubusercontent.com/u/21339385?v=4" } }, "description": "Cluster health checks This section contains a list of checks to run on your OpenShift 3.9+ source and 4.x target clusters before migration. The pur..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="prev" href="/openshift-migration-best-practices/01-planning.html"><link rel="next" href="/openshift-migration-best-practices/03-pre-migration-testing.html"><link rel="canonical" href="/openshift-migration-best-practices/02-cluster-health-checks.html"><link rel="icon" type="image/svg+xml" href="/openshift-migration-best-practices/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/openshift-migration-best-practices/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/openshift-migration-best-practices/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/openshift-migration-best-practices/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/openshift-migration-best-practices/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/openshift-migration-best-practices/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "OpenShift Migration Best Practices", baseurl: "/openshift-migration-best-practices", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/openshift-migration-best-practices/" title="Best practices for migrating from OpenShift 3 to 4"> <i class="fa fa-home"></i> OpenShift Migration Best Practices </a> </div> <span class="version"></span> <form class="search pt-2" action="/openshift-migration-best-practices/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/openshift-migration-best-practices/01-planning.html">Planning</a> </li> <li class="toc level-1 current" data-sort="" data-level="1"> <a class="d-flex flex-items-baseline current" href="/openshift-migration-best-practices/02-cluster-health-checks.html">Cluster health checks</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/openshift-migration-best-practices/03-pre-migration-testing.html">Premigration testing</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/openshift-migration-best-practices/04-running-the-migration.html">Running the migration</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/openshift-migration-best-practices/05-troubleshooting.html">Troubleshooting</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/openshift-migration-best-practices/06-post-migration-considerations.html">Postmigration considerations</a> </li> </ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/openshift-migration-best-practices/">OpenShift Migration Best Practices</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/openshift-migration-best-practices/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" aria-current="page">02-cluster-health-checks.md</li></ul> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h1 id="cluster-health-checks">Cluster health checks</h1> <p>This section contains a list of checks to run on your OpenShift 3.9+ source and 4.x target clusters before migration. The purpose of these checks is to detect issues that might affect the migration process.</p> <p>This list is not comprehensive and the verification of these checks does not guarantee a successful migration. We recommend getting in contact with the support team before migrating a cluster from OpenShift 3 to 4, especially if the cluster is in a production environment.</p> <h2 id="general-health">General health</h2> <h3 id="source-cluster">Source cluster</h3> <p>You can perform the following health checks on an OpenShift 3.9+ source cluster:</p> <ul> <li>Check that the OpenShift <a href="https://docs.openshift.com/container-platform/4.7/migration/migrating_3_4/migrating-application-workloads-3-4.html#migration-prerequisites_migrating-3-4">version is supported</a> by the migration tool.</li> <li>Verify that all nodes in the OpenShift cluster contain an active OpenShift Container Platform subscription. This will avoid issues in case support needs to be contacted.</li> <li>Install and configure <a href="https://docs.openshift.com/container-platform/3.11/install_config/prometheus_cluster_monitoring.html">Prometheus cluster monitoring</a>. Prometheus provides a detailed view of the health of the cluster components.</li> <li> <p>Check the node status to verify that all nodes are in a <strong>Ready</strong> state:</p> <div class="language-sh highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc get nodes
</code></pre>  </div> </div> </li> <li> <p>Check the persistent volumes (PVs):</p> <div class="language-sh highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc get pv
</code></pre>  </div> </div> <ul> <li>Mounted PVs</li> <li>Unmounted PVs</li> <li>Abnormal configurations</li> <li>PVs stuck in terminating state</li> </ul> </li> <li> <p>Check pods for status that is not <strong>Running</strong> or <strong>Completed</strong>. Use the following command because pods might not display an error state:</p> <div class="language-sh highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc get pods <span class="nt">--all-namespaces</span>|egrep <span class="nt">-v</span> <span class="s1">'Running | Completed'</span>
</code></pre>  </div> </div> </li> <li>Check for pods with a high restart count. Even if they are in a <strong>Running</strong> state, a high restart count might indicate underlying problems. <div class="language-sh highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="c"># Get pods with a restartCount above 3</span>
<span class="nv">$ </span>oc get pods <span class="nt">--all-namespaces</span> <span class="nt">--field-selector</span><span class="o">=</span>status.phase<span class="o">=</span>Running <span class="nt">-o</span> json | jq <span class="s1">'.items[]|select(any( .status.containerStatuses[]; .restartCount &gt; 3))|.metadata.name'</span>
</code></pre>  </div> </div> </li> <li>Check the <a href="https://access.redhat.com/articles/3093761">health of the <strong>etcd</strong> cluster</a>.</li> <li>Check the <a href="https://docs.openshift.com/container-platform/3.11/day_two_guide/environment_health_checks.html#connectivity-on-master-hosts">network connectivity</a> between master hosts.</li> <li>Check the <a href="https://docs.openshift.com/container-platform/3.11/day_two_guide/environment_health_checks.html#day-two-guide-api-service-status">API service status</a>.</li> <li>Check that the cluster certificates are not close to expiration and will be valid for the duration of the migration process. You can use the <a href="https://docs.openshift.com/container-platform/3.11/install_config/redeploying_certificates.html#install-config-cert-expiry"><code class="language-plaintext highlighter-rouge notranslate">easy-mode</code> Ansible playbook</a> to check the certificates.</li> <li> <p>Check for pending certificate signing requests:</p> <div class="language-sh highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>oc get csr
</code></pre>  </div> </div> </li> <li>Check that <a href="https://docs.openshift.com/container-platform/3.11/day_two_guide/run_once_tasks.html#day-two-guide-ntp-synchronization">time synchronization</a> is consistent across the whole cluster.</li> <li>Check that the internal container image registry is healthy, images can be read from and written to it.</li> <li>Check that the internal container image registry uses a <a href="https://docs.openshift.com/container-platform/3.11/scaling_performance/optimizing_storage.html#registry">supported storage type</a>.</li> <li>Check that applications are not using <a href="https://docs.openshift.com/container-platform/4.7/migration/migrating_3_4/troubleshooting-3-4.html#migration-gvk-incompatibility_migrating-3-4">deprecated Kubernetes API references</a>. MTC will warn you about any resources using deprecated Kubernetes API references.</li> <li>Check that all nodes in the cluster have <a href="https://docs.openshift.com/container-platform/3.11/day_two_guide/run_once_tasks.html#day-two-guide-entropy">high entropy value</a>.</li> </ul> <h3 id="target-cluster">Target cluster</h3> <p>You can perform the following health checks on an OpenShift 4.x target cluster:</p> <ul> <li> <p>Check that the cluster has access to external services required by the applications by verifying network connectivity and proper permissions.</p> <p>Examples of external services include databases, source code repositories, container image registries, and CI/CD tools.</p> </li> <li>Check that external applications, services, and appliances that use services provided by the target cluster have access and proper permissions.</li> <li> <p>Verify that all internal container image dependencies are met.</p> <p>If an application requires an image that is not in the application namespace, check that the image exists. For example, an application that uses the <code class="language-plaintext highlighter-rouge notranslate">php:7.1</code> base image from the PHP image stream on an OpenShift 3.11 cluster will not work on an OpenShift 4.x cluster because that particular version is not included in the PHP image stream for OpenShift 4. See <a href="https://docs.openshift.com/container-platform/4.7/migration/migrating_3_4/migrating-application-workloads-3-4.html#migration-prerequisites_migrating-3-4">migration prerequisites</a> for a list of image stream tags that have been removed from OpenShift 4.2.</p> <p>You can <a href="#manually-updating-images-from-openshift-3-to-4">manually update the image stream tag of internal images</a> from OpenShift 3 to 4 with Podman.</p> </li> </ul> <h2 id="resource-capacity">Resource capacity</h2> <ul> <li>The clusters require additional memory, CPUs, and storage in order to run a migration on top of normal workloads. Actual resource requirements depend on the number of Kubernetes resources being migrated in a single migration plan.</li> <li>Check that the OpenShift 3.9+ source cluster meets the <a href="https://docs.openshift.com/container-platform/3.11/install/prerequisites.html#hardware">minimum hardware requirements</a> for an OpenShift installation.</li> <li>Check that the OpenShift 4.x target cluster meets the minimum hardware requirements for the specific platform and installation method. For example, a bare metal installation has <a href="https://docs.openshift.com/container-platform/4.7/installing/installing_bare_metal/installing-bare-metal.html#minimum-resource-requirements_installing-bare-metal">specific minimum resource requirements</a>.</li> <li>Verify that the OpenShift 4.x target cluster contains storage classes for the same types (block, file, object) as the OpenShift 3.9+ source cluster.</li> <li>Check the available bandwidth between the source and target clusters. Less than 10 Gbps is not recommended.</li> <li>If you are migrating more than 20 TB, check that the target cluster and the replication repository have sufficient storage.</li> </ul> <h2 id="performance">Performance</h2> <ul> <li>Check cluster compute and memory utilization: <code class="language-plaintext highlighter-rouge notranslate">$ oc adm top node</code>.</li> <li>Check the average response time of API calls in the source cluster. Less than 50 ms. is recommended.</li> <li>Check <code class="language-plaintext highlighter-rouge notranslate">etcd</code> disk performance on the source and target clusters with <a href="https://access.redhat.com/solutions/4885641"><code class="language-plaintext highlighter-rouge notranslate">fio</code></a>.</li> </ul> <h2 id="additional-checks">Additional checks</h2> <ul> <li>Review the <a href="https://docs.openshift.com/container-platform/4.7/migration/migrating_3_4/planning-migration-3-to-4.html#migration-considerations">migration considerations</a> in the OpenShift documentation.</li> <li>Verify the identity provider on the source and target clusters.</li> <li>Verify the network visibility between namespaces on the OpenShift 4.x target cluster, especially if the OpenShift 3.9+ source cluster uses the <a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/sdn.html#architecture-additional-concepts-sdn"><strong>multitenant</strong> network plugin</a>.</li> <li>OpenShift 4.x uses the <a href="https://docs.openshift.com/container-platform/4.7/networking/network_policy/about-network-policy.html"><strong>networkpolicy</strong> network plugin</a>, which has an open policy by default. All pods and services are accessible from any project.</li> </ul> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"><a href="/openshift-migration-best-practices/01-planning.html" class="btn" title="Planning" accesskey="p" rel="prev"> <i class="fa fa-arrow-circle-left"></i> Previous </a></div> <div class="next"><a href="/openshift-migration-best-practices/03-pre-migration-testing.html" class="btn" title="Premigration testing" accesskey="n" rel="next"> Next <i class="fa fa-arrow-circle-right"></i> </a></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2020-2021,</span> <a class="text-gray" href="https://github.com/redhat-cop" rel="noreferrer" target="_blank">Red Hat Communities of Practice</a> Revision <a class="text-gray" href="https://github.com/redhat-cop/openshift-migration-best-practices/commit/5c0780b69338e12110ef830cf64ea9376cc6fbec" title="5c0780b69338e12110ef830cf64ea9376cc6fbec" rel="noreferrer" target="_blank">5c0780b</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> OpenShift Migration Best Practices </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/redhat-cop/openshift-migration-best-practices" title="Stars: 67"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/redhat-cop/openshift-migration-best-practices/issues" title="Open issues: 3"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/redhat-cop/openshift-migration-best-practices/zipball/gh-pages" title="Size: 4421 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/openshift-migration-best-practices/" title="OpenShift Migration Best Practices">Software</a> is under the terms of <a href="https://github.com/redhat-cop/openshift-migration-best-practices">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>